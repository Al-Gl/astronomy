---
interface CelestialBody {
  name: string;
  color: string;
  size: number;
  orbitRadius: number;
  orbitSpeed: number;
  glowColor?: string;
  hasRing?: boolean;
}

interface Props {
  bodies?: CelestialBody[];
  sunSize?: number;
  sunColor?: string;
  containerSize?: number;
  showLabels?: boolean;
}

// Orbital speeds use compressed logarithmic scaling based on real orbital periods
// Mercury: 88 days, Venus: 225, Earth: 365, Mars: 687, Jupiter: 4333, Saturn: 10756, Uranus: 30687, Neptune: 60190
const defaultBodies: CelestialBody[] = [
  { name: 'Mercury', color: '#a6a6a6', size: 6,  orbitRadius: 52,  orbitSpeed: 4, glowColor: 'rgba(166, 166, 166, 0.5)' },
  { name: 'Venus',   color: '#e6c87a', size: 9,  orbitRadius: 75,  orbitSpeed: 7, glowColor: 'rgba(230, 200, 122, 0.5)' },
  { name: 'Earth',   color: '#4a90d9', size: 10, orbitRadius: 102, orbitSpeed: 11, glowColor: 'rgba(74, 144, 217, 0.7)' },
  { name: 'Mars',    color: '#cd5c5c', size: 7,  orbitRadius: 130, orbitSpeed: 16, glowColor: 'rgba(205, 92, 92, 0.5)' },
  { name: 'Jupiter', color: '#d4a76a', size: 26, orbitRadius: 175, orbitSpeed: 36, glowColor: 'rgba(212, 167, 106, 0.4)' },
  { name: 'Saturn',  color: '#e6d4a3', size: 22, orbitRadius: 225, orbitSpeed: 54, hasRing: true, glowColor: 'rgba(230, 212, 163, 0.4)' },
  { name: 'Uranus',  color: '#a5d6d6', size: 14, orbitRadius: 268, orbitSpeed: 76, glowColor: 'rgba(165, 214, 214, 0.5)' },
  { name: 'Neptune', color: '#4169e1', size: 13, orbitRadius: 305, orbitSpeed: 100, glowColor: 'rgba(65, 105, 225, 0.6)' },
];

const {
  bodies = defaultBodies,
  sunSize = 40,
  sunColor = '#ffd700',
  containerSize = 700,
  showLabels = false
} = Astro.props;
---

<div class="orrery-container">
  <div class="orrery" style={`--container-size: ${containerSize}px;`}>
    <!-- Orbit paths (static, non-rotating) -->
    {bodies.map((body) => (
      <div
        class="orbit-path"
        style={`--orbit-size: ${body.orbitRadius * 2}px;`}
      ></div>
    ))}

    <!-- Central Sun -->
    <div class="sun" style={`--sun-size: ${sunSize}px; --sun-color: ${sunColor};`}></div>

    <!-- Planets -->
    {bodies.map((body, index) => (
      <div
        class="orbit-wrapper"
        style={`--orbit-radius: ${body.orbitRadius}px; --orbit-speed: ${body.orbitSpeed}s; --start-angle: ${index * 45}deg;`}
      >
        <div
          class={`planet planet-${body.name.toLowerCase()}`}
          style={`--planet-size: ${body.size}px; --planet-color: ${body.color}; --planet-glow: ${body.glowColor || 'transparent'};`}
        >
          {body.hasRing && <div class="saturn-ring"></div>}
        </div>
        {showLabels && <span class="planet-label">{body.name}</span>}
      </div>
    ))}
  </div>
</div>

<style>
  .orrery-container {
    width: 100%;
    max-width: 800px;
    margin: var(--space-xl) auto;
    padding: var(--space-lg);
    background: linear-gradient(180deg, rgba(8, 8, 12, 0.95) 0%, rgba(4, 4, 8, 0.98) 100%);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: var(--radius-lg);
  }

  .orrery {
    position: relative;
    width: 100%;
    aspect-ratio: 1;
    max-width: var(--container-size, 700px);
    margin: 0 auto;
  }

  /* Static orbit paths */
  .orbit-path {
    position: absolute;
    top: 50%;
    left: 50%;
    width: var(--orbit-size);
    height: var(--orbit-size);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
  }

  /* Central Sun */
  .sun {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: var(--sun-size, 40px);
    height: var(--sun-size, 40px);
    background: radial-gradient(circle at 35% 35%, #fff8e0 0%, #ffd700 35%, #ffa500 70%, #ff6600 100%);
    border-radius: 50%;
    box-shadow:
      0 0 20px 5px rgba(255, 200, 50, 0.8),
      0 0 40px 10px rgba(255, 150, 0, 0.5),
      0 0 60px 15px rgba(255, 100, 0, 0.3);
    animation: sunGlow 3s ease-in-out infinite;
    z-index: 10;
  }

  @keyframes sunGlow {
    0%, 100% {
      box-shadow:
        0 0 20px 5px rgba(255, 200, 50, 0.8),
        0 0 40px 10px rgba(255, 150, 0, 0.5),
        0 0 60px 15px rgba(255, 100, 0, 0.3);
    }
    50% {
      box-shadow:
        0 0 25px 8px rgba(255, 200, 50, 0.9),
        0 0 50px 15px rgba(255, 150, 0, 0.6),
        0 0 80px 20px rgba(255, 100, 0, 0.4);
    }
  }

  /* Orbit wrapper - this rotates around the sun */
  .orbit-wrapper {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    transform-origin: center;
    animation: orbitRotate var(--orbit-speed) linear infinite;
    animation-delay: calc(var(--start-angle) / 360 * var(--orbit-speed) * -1);
  }

  @keyframes orbitRotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* Planet positioning and styling */
  .planet {
    position: absolute;
    top: calc(var(--orbit-radius) * -1);
    left: 50%;
    width: var(--planet-size);
    height: var(--planet-size);
    margin-left: calc(var(--planet-size) / -2);
    margin-top: calc(var(--planet-size) / -2);
    background: var(--planet-color);
    border-radius: 50%;
    box-shadow:
      0 0 calc(var(--planet-size) * 0.6) var(--planet-glow),
      inset -2px -2px calc(var(--planet-size) * 0.25) rgba(0, 0, 0, 0.5);
  }

  /* Individual planet styles */
  .planet-mercury {
    background: radial-gradient(circle at 35% 35%, #c8c8c8 0%, #a6a6a6 50%, #787878 100%);
  }

  .planet-venus {
    background: radial-gradient(circle at 35% 35%, #f0dca0 0%, #e6c87a 50%, #c8a860 100%);
  }

  .planet-earth {
    background: radial-gradient(circle at 35% 35%, #6ab0e8 0%, #4a90d9 40%, #2a70b9 100%);
  }

  .planet-mars {
    background: radial-gradient(circle at 35% 35%, #e07060 0%, #cd5c5c 50%, #a04040 100%);
  }

  .planet-jupiter {
    background: linear-gradient(180deg,
      #e8d8b0 0%,
      #d4a76a 20%,
      #c89858 35%,
      #e8d8b0 50%,
      #c89858 65%,
      #d4a76a 80%,
      #e8d8b0 100%
    );
  }

  .planet-saturn {
    background: linear-gradient(180deg,
      #f0e8c8 0%,
      #e6d4a3 30%,
      #d8c490 50%,
      #e6d4a3 70%,
      #f0e8c8 100%
    );
  }

  .planet-uranus {
    background: radial-gradient(circle at 35% 35%, #c8e8e8 0%, #a5d6d6 50%, #80b8b8 100%);
  }

  .planet-neptune {
    background: radial-gradient(circle at 35% 35%, #6080e8 0%, #4169e1 50%, #3050b0 100%);
  }

  /* Saturn's ring */
  .saturn-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    width: calc(var(--planet-size) * 2);
    height: calc(var(--planet-size) * 0.5);
    transform: translate(-50%, -50%) rotateX(75deg);
    border-radius: 50%;
    background: linear-gradient(90deg,
      transparent 0%,
      rgba(200, 180, 140, 0.2) 15%,
      rgba(200, 180, 140, 0.5) 30%,
      rgba(180, 160, 120, 0.3) 45%,
      rgba(200, 180, 140, 0.5) 55%,
      rgba(180, 160, 120, 0.3) 70%,
      rgba(200, 180, 140, 0.2) 85%,
      transparent 100%
    );
    pointer-events: none;
  }

  /* Planet labels - positioned outside the rotating wrapper context */
  .planet-label {
    position: absolute;
    top: calc(var(--orbit-radius) * -1 + 20px);
    left: 50%;
    transform: translateX(-50%) rotate(calc(var(--start-angle) * -1));
    animation: labelCounterRotate var(--orbit-speed) linear infinite;
    animation-delay: calc(var(--start-angle) / 360 * var(--orbit-speed) * -1);
    font-size: 0.65rem;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.7);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    white-space: nowrap;
    pointer-events: none;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
  }

  @keyframes labelCounterRotate {
    from { transform: translateX(-50%) rotate(0deg); }
    to { transform: translateX(-50%) rotate(-360deg); }
  }

  /* Responsive */
  @media (max-width: 768px) {
    .orrery-container {
      padding: var(--space-md);
    }

    .orrery {
      transform: scale(0.65);
      transform-origin: center;
    }
  }

  @media (max-width: 480px) {
    .orrery {
      transform: scale(0.5);
    }

    .planet-label {
      display: none;
    }
  }
</style>
