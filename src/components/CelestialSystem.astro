---
interface CelestialBody {
  name: string;
  color: string;
  size: number;
  orbitRadius: number;
  orbitSpeed: number;
  glowColor?: string;
  hasRing?: boolean;
}

interface Props {
  bodies?: CelestialBody[];
  sunSize?: number;
  sunColor?: string;
  containerSize?: number;
  showLabels?: boolean;
}

// Orbital speeds use compressed logarithmic scaling based on real orbital periods
// Mercury: 88 days, Venus: 225, Earth: 365, Mars: 687, Jupiter: 4333, Saturn: 10756, Uranus: 30687, Neptune: 60190
const defaultBodies: CelestialBody[] = [
  { name: 'Mercury', color: '#b5b5b5', size: 5,  orbitRadius: 50,  orbitSpeed: 4, glowColor: 'rgba(180, 180, 180, 0.4)' },
  { name: 'Venus',   color: '#e8cda0', size: 8,  orbitRadius: 72,  orbitSpeed: 7, glowColor: 'rgba(232, 205, 160, 0.5)' },
  { name: 'Earth',   color: '#6b93d6', size: 9,  orbitRadius: 98,  orbitSpeed: 11, glowColor: 'rgba(74, 144, 217, 0.6)' },
  { name: 'Mars',    color: '#c1440e', size: 6,  orbitRadius: 125, orbitSpeed: 16, glowColor: 'rgba(193, 68, 14, 0.5)' },
  { name: 'Jupiter', color: '#d8ca9d', size: 22, orbitRadius: 170, orbitSpeed: 36, glowColor: 'rgba(216, 202, 157, 0.4)' },
  { name: 'Saturn',  color: '#f4d59e', size: 18, orbitRadius: 215, orbitSpeed: 54, hasRing: true, glowColor: 'rgba(244, 213, 158, 0.4)' },
  { name: 'Uranus',  color: '#d1e7e7', size: 12, orbitRadius: 255, orbitSpeed: 76, glowColor: 'rgba(147, 197, 197, 0.5)' },
  { name: 'Neptune', color: '#5b5ddf', size: 12, orbitRadius: 290, orbitSpeed: 100, glowColor: 'rgba(91, 93, 223, 0.6)' },
];

const {
  bodies = defaultBodies,
  sunSize = 36,
  sunColor = '#ffd700',
  containerSize = 680,
  showLabels = false
} = Astro.props;
---

<div class="orrery-container">
  <!-- Starfield background -->
  <div class="orrery-stars"></div>

  <div class="orrery" style={`--container-size: ${containerSize}px;`}>
    <!-- Central Sun -->
    <div class="sun" style={`--sun-size: ${sunSize}px; --sun-color: ${sunColor};`}>
      <div class="sun-corona"></div>
    </div>

    <!-- Planets and their orbits -->
    {bodies.map((body, index) => (
      <div
        class={`orbit orbit-${body.name.toLowerCase()}`}
        style={`--orbit-size: ${body.orbitRadius * 2}px; --orbit-speed: ${body.orbitSpeed}s; --orbit-delay: ${index * -2}s;`}
      >
        <div
          class={`planet planet-${body.name.toLowerCase()}`}
          style={`
            --planet-size: ${body.size}px;
            --planet-color: ${body.color};
            --planet-glow: ${body.glowColor || 'transparent'};
            --orbit-speed: ${body.orbitSpeed}s;
          `}
        >
          {body.hasRing && <div class="planet-ring"></div>}
          {showLabels && <span class="planet-label">{body.name}</span>}
        </div>
      </div>
    ))}
  </div>
</div>

<style>
  .orrery-container {
    position: relative;
    width: 100%;
    max-width: 850px;
    margin: var(--space-xl) auto;
    padding: var(--space-xl);
    background: radial-gradient(ellipse at center, rgba(15, 23, 42, 0.9) 0%, rgba(3, 7, 18, 0.95) 100%);
    border: 1px solid rgba(100, 150, 255, 0.1);
    border-radius: var(--radius-lg);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    overflow: hidden;
  }

  /* Starfield effect */
  .orrery-stars {
    position: absolute;
    inset: 0;
    background-image:
      radial-gradient(1px 1px at 20px 30px, rgba(255,255,255,0.8), transparent),
      radial-gradient(1px 1px at 40px 70px, rgba(255,255,255,0.6), transparent),
      radial-gradient(1px 1px at 50px 160px, rgba(255,255,255,0.7), transparent),
      radial-gradient(1px 1px at 90px 40px, rgba(255,255,255,0.5), transparent),
      radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.6), transparent),
      radial-gradient(1.5px 1.5px at 160px 120px, rgba(255,255,255,0.9), transparent),
      radial-gradient(1px 1px at 200px 50px, rgba(255,255,255,0.5), transparent),
      radial-gradient(1px 1px at 250px 90px, rgba(255,255,255,0.7), transparent),
      radial-gradient(1px 1px at 300px 140px, rgba(255,255,255,0.6), transparent),
      radial-gradient(1.5px 1.5px at 350px 30px, rgba(255,255,255,0.8), transparent),
      radial-gradient(1px 1px at 400px 100px, rgba(255,255,255,0.5), transparent),
      radial-gradient(1px 1px at 450px 60px, rgba(255,255,255,0.7), transparent),
      radial-gradient(1px 1px at 500px 180px, rgba(255,255,255,0.6), transparent),
      radial-gradient(1.5px 1.5px at 550px 120px, rgba(255,255,255,0.9), transparent),
      radial-gradient(1px 1px at 600px 40px, rgba(255,255,255,0.5), transparent),
      radial-gradient(1px 1px at 650px 160px, rgba(255,255,255,0.6), transparent),
      radial-gradient(1px 1px at 700px 80px, rgba(255,255,255,0.7), transparent),
      radial-gradient(1px 1px at 750px 130px, rgba(255,255,255,0.5), transparent),
      radial-gradient(1px 1px at 100px 200px, rgba(255,255,255,0.6), transparent),
      radial-gradient(1.5px 1.5px at 180px 250px, rgba(255,255,255,0.8), transparent),
      radial-gradient(1px 1px at 280px 220px, rgba(255,255,255,0.5), transparent),
      radial-gradient(1px 1px at 380px 280px, rgba(255,255,255,0.7), transparent),
      radial-gradient(1px 1px at 480px 240px, rgba(255,255,255,0.6), transparent),
      radial-gradient(1px 1px at 580px 300px, rgba(255,255,255,0.5), transparent),
      radial-gradient(1.5px 1.5px at 680px 260px, rgba(255,255,255,0.9), transparent);
    opacity: 0.6;
    pointer-events: none;
  }

  .orrery {
    position: relative;
    width: 100%;
    aspect-ratio: 1;
    max-width: var(--container-size, 680px);
    margin: 0 auto;
  }

  /* Central Sun with corona effect */
  .sun {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: var(--sun-size, 36px);
    height: var(--sun-size, 36px);
    background: radial-gradient(circle at 30% 30%, #fffbe6 0%, #ffd700 40%, #ff9500 70%, #ff6b00 100%);
    border-radius: 50%;
    box-shadow:
      0 0 20px #ffd700,
      0 0 40px rgba(255, 180, 0, 0.8),
      0 0 60px rgba(255, 140, 0, 0.6),
      0 0 100px rgba(255, 100, 0, 0.4);
    animation: sunPulse 4s ease-in-out infinite;
    z-index: 10;
  }

  .sun-corona {
    position: absolute;
    inset: -8px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 200, 100, 0.3) 0%, transparent 70%);
    animation: coronaPulse 3s ease-in-out infinite alternate;
  }

  @keyframes sunPulse {
    0%, 100% {
      box-shadow:
        0 0 20px #ffd700,
        0 0 40px rgba(255, 180, 0, 0.8),
        0 0 60px rgba(255, 140, 0, 0.6),
        0 0 100px rgba(255, 100, 0, 0.4);
      transform: translate(-50%, -50%) scale(1);
    }
    50% {
      box-shadow:
        0 0 25px #ffd700,
        0 0 50px rgba(255, 180, 0, 0.9),
        0 0 80px rgba(255, 140, 0, 0.7),
        0 0 120px rgba(255, 100, 0, 0.5);
      transform: translate(-50%, -50%) scale(1.02);
    }
  }

  @keyframes coronaPulse {
    0% { opacity: 0.5; transform: scale(1); }
    100% { opacity: 0.8; transform: scale(1.1); }
  }

  /* Orbital Paths - gradient effect */
  .orbit {
    position: absolute;
    top: 50%;
    left: 50%;
    width: var(--orbit-size);
    height: var(--orbit-size);
    border: 1px solid transparent;
    border-radius: 50%;
    transform: translate(-50%, -50%) scaleY(0.85);
    animation: orbit var(--orbit-speed) linear infinite;
    animation-delay: var(--orbit-delay, 0s);
    background:
      linear-gradient(rgba(10, 20, 40, 0.95), rgba(10, 20, 40, 0.95)) padding-box,
      linear-gradient(135deg, rgba(100, 150, 255, 0.15) 0%, rgba(100, 150, 255, 0.05) 50%, rgba(100, 150, 255, 0.15) 100%) border-box;
  }

  /* Add subtle glow to orbit paths on hover */
  .orbit::before {
    content: '';
    position: absolute;
    inset: -1px;
    border-radius: 50%;
    background: transparent;
    transition: box-shadow 0.3s ease;
  }

  @keyframes orbit {
    from {
      transform: translate(-50%, -50%) scaleY(0.85) rotate(0deg);
    }
    to {
      transform: translate(-50%, -50%) scaleY(0.85) rotate(360deg);
    }
  }

  /* Planets with enhanced visuals */
  .planet {
    position: absolute;
    top: 0;
    left: 50%;
    width: var(--planet-size);
    height: var(--planet-size);
    background: var(--planet-color);
    border-radius: 50%;
    transform: translateX(-50%) translateY(-50%);
    animation: counterRotate var(--orbit-speed) linear infinite;
    box-shadow:
      0 0 calc(var(--planet-size) * 0.5) var(--planet-glow),
      inset -2px -2px calc(var(--planet-size) * 0.3) rgba(0, 0, 0, 0.4);
  }

  @keyframes counterRotate {
    from {
      transform: translateX(-50%) translateY(-50%) scaleY(1.176) rotate(0deg);
    }
    to {
      transform: translateX(-50%) translateY(-50%) scaleY(1.176) rotate(-360deg);
    }
  }

  /* Mercury - cratered look */
  .planet-mercury {
    background: radial-gradient(circle at 35% 35%, #d4d4d4 0%, #b5b5b5 50%, #8a8a8a 100%);
  }

  /* Venus - cloudy atmosphere */
  .planet-venus {
    background: radial-gradient(circle at 35% 35%, #f5e6c8 0%, #e8cda0 40%, #d4b88a 100%);
  }

  /* Earth - with atmosphere hint */
  .planet-earth {
    background: radial-gradient(circle at 35% 35%, #8fb8e8 0%, #6b93d6 40%, #4a7ab8 100%);
    box-shadow:
      0 0 15px rgba(74, 144, 217, 0.7),
      0 0 30px rgba(74, 144, 217, 0.4),
      inset -2px -2px 6px rgba(0, 0, 0, 0.3);
  }

  /* Mars - red with terrain */
  .planet-mars {
    background: radial-gradient(circle at 35% 35%, #e07050 0%, #c1440e 50%, #8a2a08 100%);
  }

  /* Jupiter - banded atmosphere */
  .planet-jupiter {
    background:
      linear-gradient(180deg,
        #e8dbb8 0%,
        #d8ca9d 15%,
        #c4a882 25%,
        #e8dbb8 35%,
        #b89a6a 50%,
        #d8ca9d 65%,
        #c4a882 75%,
        #e8dbb8 85%,
        #d8ca9d 100%
      );
    box-shadow:
      0 0 20px rgba(216, 202, 157, 0.5),
      inset -3px -3px 10px rgba(0, 0, 0, 0.3);
  }

  /* Saturn - golden with subtle bands */
  .planet-saturn {
    background:
      linear-gradient(180deg,
        #f8e8b8 0%,
        #f4d59e 30%,
        #e8c88a 50%,
        #f4d59e 70%,
        #f8e8b8 100%
      );
    box-shadow:
      0 0 15px rgba(244, 213, 158, 0.5),
      inset -2px -2px 8px rgba(0, 0, 0, 0.25);
  }

  /* Saturn's Ring - improved */
  .planet-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 38px;
    height: 14px;
    border: none;
    border-radius: 50%;
    transform: translate(-50%, -50%) rotateX(70deg);
    pointer-events: none;
    background:
      linear-gradient(90deg,
        transparent 0%,
        rgba(210, 180, 140, 0.15) 10%,
        rgba(210, 180, 140, 0.4) 20%,
        rgba(180, 150, 120, 0.2) 30%,
        rgba(210, 180, 140, 0.5) 40%,
        rgba(180, 150, 120, 0.2) 50%,
        rgba(210, 180, 140, 0.5) 60%,
        rgba(180, 150, 120, 0.2) 70%,
        rgba(210, 180, 140, 0.4) 80%,
        rgba(210, 180, 140, 0.15) 90%,
        transparent 100%
      );
    box-shadow:
      0 0 4px rgba(210, 180, 140, 0.3),
      inset 0 0 8px rgba(210, 180, 140, 0.2);
  }

  /* Uranus - ice giant with tilt hint */
  .planet-uranus {
    background: radial-gradient(circle at 40% 40%, #e8f4f4 0%, #d1e7e7 40%, #a8d4d4 70%, #7ab8b8 100%);
    box-shadow:
      0 0 15px rgba(147, 197, 197, 0.6),
      inset -2px -2px 6px rgba(0, 0, 0, 0.2);
  }

  /* Neptune - deep blue ice giant */
  .planet-neptune {
    background: radial-gradient(circle at 35% 35%, #8b8dff 0%, #5b5ddf 40%, #4040b0 70%, #2a2a80 100%);
    box-shadow:
      0 0 18px rgba(91, 93, 223, 0.7),
      0 0 35px rgba(91, 93, 223, 0.4),
      inset -2px -2px 6px rgba(0, 0, 0, 0.3);
  }

  /* Planet Labels - improved styling */
  .planet-label {
    position: absolute;
    top: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.55rem;
    color: rgba(255, 255, 255, 0.7);
    white-space: nowrap;
    pointer-events: none;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 600;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
    background: rgba(0, 0, 0, 0.4);
    padding: 2px 6px;
    border-radius: 3px;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .orrery-container {
      padding: var(--space-md);
      margin: var(--space-lg) auto;
    }

    .orrery {
      transform: scale(0.6);
      transform-origin: center;
    }

    .planet-label {
      font-size: 0.45rem;
      padding: 1px 4px;
    }
  }

  @media (max-width: 480px) {
    .orrery {
      transform: scale(0.42);
    }

    .planet-label {
      display: none;
    }
  }
</style>
